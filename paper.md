# iRONS: interactive Reservoir Operation Notebooks and Software for water reservoir systems simulation and optimisation

Andres Pe√±uela, Francesca Pianosi

## **Summary**

Computer-based models enable the simulation of water fluxes in water resource systems, such as reservoirs and diversions, in response to natural forcing inputs (e.g. streamflows) and human actions (e.g. abstractions/releases). As such they can be valuable tools to anticipate and compare the effects of different management decisions in the presence of potentially competing uses of water and uncertainty about future hydrological conditions (Brown et al., 2015). Combined with an optimisation algorithm, simulation models can also be used to systematise the trial-and-error process and directly generate 'optimal' decisions, such as the optimal operating policy of a reservoir or the optimal release scheduling for the week/month ahead (Dobson et al., 2019). 

iRONS is a python package that enables the simulation, forecasting and optimisation of reservoir systems. The package includes a set of interactive notebooks that demonstrate key functionalities through practical examples, and that can be run in the Jupyter environment either locally or remotely via a web browser. Hence, compared to other available packages for reservoir simulation and optimisation, such as the web-based application ResOS (Jahanpour et al., 2014) or the R package reservoir (Turner and Galelli, 2016), iRONS has the advantage of combining the user-friendliness of web-based applications with the transparency and adaptability of open-source code, and provides both code and workflow examples for its use. As such, iRONS aims at being accessible to a range of users with more or less expertise in reservoir operation and/or computer programming, and contribute to increase the uptake of state-of-art methodologies while reducing the gap between research and practice in water resource systems analysis (Rosenberg et al., 2017).

**The core functions**

The iRONS package provides a set of functions implementing typical reservoir modelling tasks, such as: estimating inflows to a reservoir, simulating operator decisions, closing the reservoir mass balance equation -- in the context of both short-term forecasting and long-term predictions. The code includes a lot of comments and is generally written in a "math-like" style that aims to maximise readability, occasionally using less efficient but more legible coding options (for example, a for loop in place of vectorisation). Computational efficiency is regained by making the code compatible with the Numba just-in-time compiler (<http://numba.pydata.org/>; Lam et al. (2015), Marowka (2018)). Functions can thus be used within computationally expensive tasks (e.g. Monte Carlo simulation and multi-objective optimization). The structure of the code is modular, so to facilitate the integration of other Python functions or packages, for example the Platypus package for high performance multi-objective optimization (<https://platypus.readthedocs.io/>) or the Python version of the SAFE toolbox for Global Sensitivity Analysis (<https://safetoolbox.info/>). Modularity and legibility of the package functions also facilitates their tailoring to a variety of problems, from single to multiple reservoir systems, and their integration into other hydrological models at different scales.

**The notebooks**

Jupyter Notebooks (<http://jupyter.org/>) is a literate programming environment that combines executable code, rich media, computational output and explanatory text in a single document. The result is a computational narrative that builds stronger links between code, data and results (Perkel, 2018). The notebooks included in iRONS are divided in two sections:

A. Knowledge transfer. A set of simple examples to demonstrate the value of simulation and optimisation tools for water resources management -- i.e. *why* one should use these tools in the first place. The Notebooks cover a range of concepts relevant to reservoir operation, such as: manual vs automatic calibration of rainfall-runoff models, what-if analysis vs optimisation, optimisation under conflicting objectives and under uncertainty, optimisation of release scheduling vs operating policy.

B. Implementation. A set of workflow examples showing *how* to apply the iRONS functions to more complex problems such as: generating inflow forecasts through a rainfall-runoff model (including bias correcting weather forecasts); optimising release scheduling against an inflow scenario or a forecast ensemble; optimising an operating policy against time series of historical or synthetic inflows. These Notebooks are meant to serve as a 'learn-by-doing' alternative to a User manual and a starting point for the user's own application workflows (Pianosi et al., 2020).

To facilitate the visualization of model inputs and outputs, iRONS uses integrated widgets (ipywidgets; <https://ipywidgets.readthedocs.io/>) and interactive visualization libraries (bqplot; <https://bqplot.readthedocs.io/>). Jupyter Notebooks can be downloaded and executed locally or they can be run on a web browser thanks to online services such as Binder (<https://mybinder.org/>) or Microsoft Azure Notebooks (<https://notebooks.azure.com/>).

**Outlook**

We plan to keep updating iRONS with new functions and Notebooks, and are open to contributions and improvements from others. We hope iRONS will prove a useful tool for water practitioners and researchers, as well as teachers and students in hydrology and water resource management. More broadly, we hope iRONS will inspire others to develop open-source software and literate programming environments, including interactive visualisations, and use them as possible mechanisms to accelerate the uptake of new methods and tools.

## **References**

BROWN, C. M., LUND, J. R., CAI, X., REED, P. M., ZAGONA, E. A., OSTFELD, A., HALL, J., CHARACKLIS, G. W., YU, W. & BREKKE, L. 2015. The future of water resources systems analysis: Toward a scientific framework for sustainable water management. *Water Resources Research,* 51**,** 6110-6124.DOBSON, B., WAGENER, T. & PIANOSI, F. 2019. An argument-driven classification and comparison of reservoir operation optimization methods. *Advances in Water Resources,* 128**,** 74-86.JAHANPOUR, M., SANDOVAL-SOLIS, S. & AFSHAR, A. 2014. A web-based application for optimization of single reservoir operation. 106**,** E509-E517.LAM, S. K., PITROU, A. & SEIBERT, S. 2015. Numba: a LLVM-based Python JIT compiler. *Proceedings of the Second Workshop on the LLVM Compiler Infrastructure in HPC.* Austin, Texas: ACM.MAROWKA, A. J. T. J. O. S. 2018. Python accelerators for high-performance computing. 74**,** 1449-1460.PERKEL, J. M. 2018. Why Jupyter is data scientists\' computational notebook of choice. *Nature,* 563**,** 145-147.PIANOSI, F., SARRAZIN, F. & WAGENER, T. 2020. How successfully is open-source research software adopted? Results and implications of surveying the users of a sensitivity analysis toolbox. *Environmental Modelling & Software,* 124**,** 104579.ROSENBERG, D. E., BABBAR-SEBENS, M., ROOT, E., HERMAN, J., MIRCHI, A., GIACOMONI, M., KASPRZYK, J., MADANI, K., FORD, D. & BASDEKAS, L. 2017. More Integrated Formal Education and Practice in Water Resources Systems Analysis. 143**,** 02517001.TURNER, S. W. D. & GALELLI, S. 2016. Water supply sensitivity to climate change: An R package for implementing reservoir storage analysis in global and regional impact studies. *Environmental Modelling & Software,* 76**,** 13-19.
